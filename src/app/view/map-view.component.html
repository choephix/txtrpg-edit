<style type="scss/text">
#lesvg { height:99.5vh; width:100%; }
#trash { fill:rgba(255,0,0,.05); }
#trash:hover { fill:rgba(255,0,0,.25); stroke:rgba(255,0,0,.1); stroke-width:4 }
.link { stroke:rgba(100,200,250,0.5); stroke-width:4 }
.link.tobe { stroke:rgba(0,0,0,0.125); stroke-width:8 }
.link.selected { stroke:rgba(255,225,150,1.0) }
.label { font: bold 10px monospace, sans-serif; fill: #456; user-select: none;  }
.label.subnode { fill: #456; font-weight:100; }
.link:hover { opacity : .7 }

@keyframes node-become { from { opacity: 0.0; r: 12; } }
.node {
	fill:rgba(50,100,200,1.0);
	stroke:rgba(100,200,250,0.5); 
	stroke-width:4; 
	animation-name: node-become;
  animation-duration: .100s;
}
.node.mini { fill:rgba(100,150,200,1.0) }
.node.selected { fill:rgba(255,225,150,1.0) }
.node:hover { opacity : .9; }

* {
	transition: color .150s, opacity .150s, r 150s;
}

.info { position:fixed; padding-left:1vw; top:0; font-family: monospace; opacity:.4; }
</style>

<svg id="lesvg" #lesvg mousewheel
			(wheel)="mousewheel($event)" 
			(mousedown)="mousedown($event)"
			(mouseup)="mouseup($event)"
			(mousemove)="mousemove($event)"
			(contextmenu)="contextmenu($event)">
	<ng-container *ngIf="linking">
		<line
			[attr.x1]="getViewX(linking)"
			[attr.y1]="getViewY(linking)"
			[attr.x2]="mouseX"
			[attr.y2]="mouseY"
			class="link tobe"/>
	</ng-container>

	<ng-container *ngFor="let link of w.links; let i = index">
		<line
			[attr.data-index]="i"
			[attr.x1]="getViewX(link.to)+5"
			[attr.y1]="getViewY(link.to)+random(i,5)"
			[attr.x2]="getViewX(link.from)-5"
			[attr.y2]="getViewY(link.from)-random(i,5)"
			(mouseup)="mouseup_link($event,i)"
			class="link"/>
	</ng-container>
	<ng-container *ngFor="let node of w.subnodes; let i = index">
		<line
			[attr.x1]="getViewX(node)"
			[attr.y1]="getViewY(node)"
			[attr.x2]="getViewX(node.parent)"
			[attr.y2]="getViewY(node.parent)"
			class="link"/>
	</ng-container>
	<ng-container *ngFor="let node of w.nodes; let i = index">
		<circle
			[class.selected]="selected==node"
			[attr.r]="16"
			[attr.cx]="getViewX(node)"
			[attr.cy]="getViewY(node)"
			(mousedown)="mousedown_node($event,node,false)"
			(mouseup)="mouseup_node($event,node,false)"
      (click)="click_node($event,node,false)"
			class="node"/>
		<text
			[attr.x]="getViewX(node)-14"
			[attr.y]="getViewY(node)+26"
			(mousedown)="mousedown_node($event,node,false)"
			class="label">{{node.slug}}</text>
	</ng-container>
	<ng-container *ngFor="let node of w.subnodes; let i = index">
		<circle
			[attr.data-index]="i"
			[class.selected]="selected==node"
			[attr.r]="8"
			[attr.cx]="getViewX(node)"
			[attr.cy]="getViewY(node)"
			(mousedown)="mousedown_node($event,node,true)"
			(mouseup)="mouseup_node($event,node,true)"
      (click)="click_node($event,node,true)"
			class="node subnode"/>
		<text
			[attr.x]="getViewX(node)-7"
			[attr.y]="getViewY(node)+18"
			(mousedown)="mousedown_node($event,node,true)"
			class="label subnode">{{node.slug}}</text>
	</ng-container>

	<circle id="trash"
					cx="10vh" cy="90vh" r=64
					*ngIf="!linking&&dragging"
					(mouseup)="mouseup_trash($event)"
					>
	</circle>
</svg>

<div class="info">
	<div *ngIf="zoom!=1.0">Zoom: {{zoom}}</div>
</div>